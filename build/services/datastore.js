/// <reference path="../../typings/tsd.d.ts" />
"use strict";
const stream_1 = require('stream');
const fs_1 = require('fs');
class DataStreamTransform extends stream_1.Transform {
    constructor(header) {
        super({ objectMode: true });
        this.last = "";
        this.header = [];
        this.header = header;
    }
    convertRow(row) {
        let result = {};
        this.header.forEach((x, y) => result[x] = row[y] || null);
        return result;
    }
    _transform(chunk, encoding, done) {
        let string = this.last.concat(chunk.toString()), lines = string.split("\n");
        this.last = lines.pop();
        lines.map(x => x.replace("\r", '').split("\t"))
            .forEach(x => this.push(this.convertRow(x)));
        done();
    }
}
exports.DataStreamTransform = DataStreamTransform;
exports.createDataStream = (file, header) => {
    let readableStream = fs_1.createReadStream(file, { encoding: 'UTF-8' }), dataStreamTransform = new DataStreamTransform(header);
    return readableStream.pipe(dataStreamTransform);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXN0b3JlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlcnZpY2VzL2RhdGFzdG9yZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwrQ0FBK0M7O0FBRS9DLHlCQUF3QixRQUFRLENBQUMsQ0FBQTtBQUNqQyxxQkFBK0IsSUFBSSxDQUFDLENBQUE7QUFPcEMsa0NBQXlDLGtCQUFTO0lBSTlDLFlBQVksTUFBTTtRQUNkLE1BQU0sRUFBQyxVQUFVLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztRQUo5QixTQUFJLEdBQVUsRUFBRSxDQUFDO1FBQ2pCLFdBQU0sR0FBaUIsRUFBRSxDQUFDO1FBSXRCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxVQUFVLENBQUMsR0FBRztRQUNWLElBQUksTUFBTSxHQUFlLEVBQUUsQ0FBQztRQUM1QixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQztRQUMxRCxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ2xCLENBQUM7SUFFRCxVQUFVLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJO1FBQzVCLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUMzQyxLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUUvQixJQUFJLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUN4QixLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDMUMsT0FBTyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRWpELElBQUksRUFBRSxDQUFDO0lBQ1gsQ0FBQztBQUNMLENBQUM7QUF6QlksMkJBQW1CLHNCQXlCL0IsQ0FBQTtBQUVZLHdCQUFnQixHQUFHLENBQUMsSUFBSSxFQUFFLE1BQU07SUFDekMsSUFBSSxjQUFjLEdBQUcscUJBQWdCLENBQUMsSUFBSSxFQUFFLEVBQUMsUUFBUSxFQUFFLE9BQU8sRUFBQyxDQUFDLEVBQzVELG1CQUFtQixHQUFHLElBQUksbUJBQW1CLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDMUQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUNwRCxDQUFDLENBQUMifQ==